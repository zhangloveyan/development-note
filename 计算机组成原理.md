# 计算机组成原理-结构

## 前言

1.本课程位置

![image-20230817205033777](pic/image-20230817205033777.png)

2.各个架构

![image-20230817205205906](pic/image-20230817205205906.png)

## 1. 计算机系统的层次结构

### 1.1 层级

**语言层级**

![image-20230817210150050](pic/image-20230817210150050.png)

**软硬件：**

![image-20230817210317759](pic/image-20230817210317759.png)

### 1.2 结构

**冯诺依曼计算机**：简化结构

![image-20230817210925062](pic/image-20230817210925062.png)

存在问题：

1.运算器为中心，成为瓶颈

2.没有层次结构，混乱

**现代计算机结构**

![image-20230817211315060](pic/image-20230817211315060.png)

### 1.3 编程实质

1.建立数学模型

2.确定计算方法

举例：

![image-20230817211900566](pic/image-20230817211900566.png)

相比较右边更好，步骤更少

![image-20230817212438248](pic/image-20230817212438248.png)

![image-20230817212459631](pic/image-20230817212459631.png)

### 1.4 存储器的基本组成

![image-20230817212754618](pic/image-20230817212754618.png)

MAR：存储器地址寄存器，反映存储单元的个数（有多少个房间）

MDR：存储器数据寄存器，反映存储字长

设 MAR = 4位 , MDR = 8 位 那么，存储单元个数 16 个（2^4（0000->1111））,存储字长 8

### 1.5 运算器的基本组成

![image-20230817213527205](pic/image-20230817213527205.png)

**MQ：**乘商寄存器，在做乘除运算使用

**加法运算：**其中 [M] 的 [ ] 代表内存地址的数

![image-20230818115259653](pic/image-20230818115259653.png)

**[ACC]+[X]->ACC ：将 ACC 内存地址的值 与 X 内存地址的值相加 结果写入 ACC 的内存地址**

被加数+加数=和

被减数-减数=差

被乘数x乘数=积

被除数÷除数=商……余数

**减法运算：**同加法，符号区别

**乘法运算**：

![image-20230818140949735](pic/image-20230818140949735.png)



**除法运算：**

![image-20230818162556534](pic/image-20230818162556534.png)

### 1.6 控制器

![image-20230818162851855](pic/image-20230818162851855.png)

PC 内存地址  IR 地址里面的值（指令）CU 执行他们（控制指挥）

**总流程图：**

取数指令：

![image-20230818163556056](pic/image-20230818163556056.png)

存数指令：

![image-20230818164030533](pic/image-20230818164030533.png)

**举例：**

![image-20230818164522111](pic/image-20230818164522111.png)

其中：取指令、分析指令、执行指令，这三步是循环的，进行每一步的操作

### 1.7 硬件的主要技术指标

**机器字长**

CPU 一次能处理数据的位数，通常和 CPU 的寄存器位数 有关

**运算速度**

主频、核数、吉普森法、CPI （执行一条指令所需要时钟周期）、MIPS （每秒执行百万条指令）、FLOPS （每秒浮点运算次数）

**存储容量**

存放二进制信息的总位数、主存容量、辅存容量

## 第二章 略

## 第三章 系统总线

### 3.1 总线的基本概念

**总线**：是连接各个部件的信息传输线，共享的传输介质

**信息传输**：串行、并行

举例：

**单总线结构**

![image-20230819152016932](pic\image-20230819152016932.png)

问题：同一时刻只能有一对传输，成为瓶颈

**双总线结构**

![image-20230819152334481](pic\image-20230819152334481.png)

进一步进化：

![image-20230819152530024](pic/image-20230819152530024.png)

### 3.2 总线的分类

**片内总线**：芯片内部的总线

**系统总线**：计算机各个部件之间的信息传输线

分为：数据总线（双向） 地址总线（单向） 控制总线（有出 有入）

**通信总线**：用于计算机系统之间 或 计算机系统与其他系统（控制仪表、移动通信）之间的通信

### 3.3 总线特性及性能指标

**特性**：

机械特性、电气特性、功能特性、时间特性

**性能指标**：

总线宽度、标准传输率、时钟同步/异步、总线复用、信号线数、总线控制方式、其他指标

**标准**：

![image-20230819153442451](pic/image-20230819153442451.png)

### 3.4 总线结构

单总线结构、多总线结构

**传统微型机总线结构**

![image-20230819154129397](pic/image-20230819154129397.png)

**VL-BUS 局部总线结构**

![image-20230819154210035](pic/image-20230819154210035.png)

**PCI 总线结构**

![image-20230819154234699](pic/image-20230819154234699.png)

**多层 PCI 总线结构**

![image-20230819154314296](pic/image-20230819154314296.png)

### 3.5 总线控制

**基本概念**：

- 主设备：对总线有控制权

- 从设备：响应从主设备发来的总线命令

- 总线判优控制：集中式（链式查询、计数器定时查询、独立请求方式） 分布式

**链式查询**

![image-20230819155201316](pic/image-20230819155201316.png)

**计数器定时查询**

![image-20230819160547007](pic/image-20230819160547007.png)

**独立请求方式**

![image-20230819160853905](pic/image-20230819160853905.png)

### 3.6 总线的通信控制

**目的**：解决通信双方 协调配合 问题

**方式**：同步通信、异步通信、半同步通信、分离式通信

**同步**

![image-20230819161412752](pic/image-20230819161412752.png)

**异步通信**

![image-20230819161804305](pic/image-20230819161804305.png)

**半同步**

![image-20230819162026356](pic/image-20230819162026356.png)

**分离式通信**

主模块申请占用，使用完即放弃使用权，让出。

从模块申请占用，将各种信息发送至总线上。

**总结**

异步有点类似 java 的阻塞式通信，每个线程只能处理一个请求，处理过程中一直处于等待闲置状态。

分离式通信类似 nettry 非阻塞通信，等待时，线程去处理其他请求。此时线程不会有闲置的状态。



## 第四章 存储器

### 4.1 概述

**分类**

1.按照存储介质分类：

- 半导体存储器	TTL、MOS	易失（没电就没数据了）
- 磁表面存储器    磁头、载磁体
- 磁芯存储器       硬磁材料、环状原件      非易失
- 光盘存储器       激光、磁光材料

2.按照存取方式分类

- 存取时间与物理地址无关（随机访问）
- 存取时间与物理地址有关（串行访问）磁带、磁盘

3.计算机的作用

- 主存储器
  - RAM ：静态RAM、动态RAM
  - ROM：MROM PROM EPROM EEPROM
- Flash Memory U 盘
- 高速缓冲存储器（cache）
- 辅助存储器 硬盘、光盘

层次结构

![image-20230819202415167](pic/image-20230819202415167.png)

![image-20230819203208298](pic/image-20230819203208298.png)

### 4.2 主存储器

#### 1. 基本组成

![image-20230819204047637](pic/image-20230819204047637.png)

#### 2. 与 cpu 的联系

![image-20230819204136222](pic/image-20230819204136222.png)

#### 3. 存储单元地址的分配

![image-20230819204544003](pic/image-20230819204544003.png)

字地址就是房间（3个房间）、字节地址就是床位（4张床）

#### 4.技术指标

存储容量、存储速度、存储器带宽（位/秒）

#### 5.半导体存储芯片基本结构

![image-20230819205440939](pic/image-20230819205440939.png)

![image-20230819205724882](pic/image-20230819205724882.png)

#### 6. 随机存取存储器

动态 静态 RAM 比较：

![image-20230819212930158](pic/image-20230819212930158.png)

#### 7. 只读存储器

#### 8. 存储器与 CPU 的连接

**存储器容量扩展**

位扩展（增加存储字长（床位数））、字扩展（增加存储字数量（房间数））、字、位扩展

**存储器与 CPU 的连接** 

地址线连接、数据线连接、读/写命令线连接、片选线连接（内存条上的8块芯片）

#### 9. 存储器的校验

### 4.3 高速缓冲存储器

#### 1.cache 工作原理

![image-20230819222705521](pic/image-20230819222705521.png)

主存和缓存是按块进行存储，相当于 mysql 页存储刷盘

**命中与未命中**

命中：主存块调入缓存，与缓存建立了对应关系

未命中：主存块未调入缓存，与缓存未建立了对应关系

用标记记录与某缓存块建立了对应关系的主存块号

**cache 命中率**

命中率 cache 的容量与块长有关

一般每块可取 4~8 个字

#### 2. 基本结构

![img](pic/70.png)

**读操作**：

![img](pic/16924564063382.png)

**写操作**：

- 写直达法：cahce 和 主存同时写（时刻保持一致性，但是 CPU 可能对同一地址反复读写，覆盖）
- 写回法：只写 cache，替换时才写回主存（会产生并发一致性问题）

#### 3. cache 改进

增加 cache 级数、统一缓存和分立缓存

#### 4. 地址映射

直接映射、全相联映射、组相联映射

类似 mysql 的页、段、空间这些单位，每几个块可分组存放

#### 5. 替换算法

先进先出（队列）、最近最少使用（LRU）

### 4.4 辅助存储器

不与 CPU 交换信息，机械硬盘、软盘、光盘



## 第五章 输入输出系统

### 5.1 概述

**程序查询方式**

串行工作，CPU原地踏步等待

![image-20230820102143458](pic/image-20230820102143458.png)

**程序中断方式**

![image-20230820102437761](pic/image-20230820102437761.png)

CPU 没有踏步等待，相当于 nettry 线程 等你准备好了 我在暂停处理

![image-20230820102733301](pic/image-20230820102733301.png)

以打印机为例：

![image-20230820111710140](pic/image-20230820111710140.png)

**DMA 方式**

![image-20230820104551570](pic/image-20230820104551570.png)

等你准备好了，我就占用你一个周期，把东西搞好，不中断程序

**三种方式比较**

![image-20230820104827165](pic/image-20230820104827165.png)

**IO 接口的基本组成**

![image-20230820111430419](pic/image-20230820111430419.png)





## 第六章 计算机的运算方法

### 6.1 无符号数、有符号数

无符号：正常存储

有符号：高位是正负，剩下是数值。0正数 1负数

**原码、反码、补码**的出现是为了方便计算机表示、计算负数参与的加减法运算。因此，原码，反码，补码是机器存储一个具体数字的编码方式。

**原码**:在数值前直接加一符号位的表示法，对于8位二进制来说：

[+7]原= 0 0000111 [-7]原= 1 0000111

**反码**:正数的反码与原码相同;负数的反码,符号位为“1”,数值部分按位取反。

[+7]反= 0 0000111 [-7]反= 1 1111000

**补码**:正数的补码和原码相同;负数的补码则是符号位为“1”,数值部分按位取反后再在末位(最低位)加1，也就是“反码+1”。

[+7]补= 0 0000111 [-7]补= 1 1111001

**移码:**在计算机中，移码并不常用于存储和运算，而更多用于显示和输出

[+7]移= 1 0000111 [-7]移= 0 1111001

**总结：**

**其中正整数的原码、反码、补码都一样;**

**移码就是补码的符号位取反，其余不变；**

**负数部分：**

**原码和反码的相互转换：符号位不变，数值位按位取反;**

**原码和补码的相互转换：符号位不变，数值位按位取反,末位再加1;**

**移码就是补码的符号位取反，其余不变；**

### 6.2 数的定点、浮点表示

定点表示：由于没有专门存储小数，一般按照约定方式标出。有以下两种：

![image-20230821145249776](pic/image-20230821145249776.png)

浮点表示：

![image-20230821150214584](pic/image-20230821150214584.png)

IEEE 754 标准

![image-20230821152448797](pic/image-20230821152448797.png)

浮点数和定点数的转换是一种映射。将较为密集的数据空间（F32）映射到较为稀疏的空间（int8）；

**算术移位规则**

![image-20230821154526746](pic/image-20230821154526746.png)

例子：

![image-20230821155850328](pic/image-20230821155850328.png)

![image-20230821155917481](pic/image-20230821155917481.png)

![image-20230821155941916](pic/image-20230821155941916.png)

### 6.3 定点运算

**移位运算**：相对于小数点不懂，数字移动，左移扩大 2 倍，右移缩小 2 倍

### 6.4 浮点四则运算

### 6.5 算数逻辑单元 ALU 

## 第七章 指令系统

7.1 机器指令

7.2 操作数类型和操作类型

7.3 寻址方式

7.4 指令格式举例

7.5 RISC 技术





































































































































## 其他

### 名词解析：

**系统软件（System Software）:**

系统软件位于计算机系统中最靠近硬件的一层，其他软件一般都通过系统软件发挥作用。它与具体的应用领域无关。包括操作系统、计算机语言处理程序（各种程序翻译软件，包括编译程序、解释程序、汇编程序）、服务性程序、数据库管理系统和网络软件等。

**应用软件（Application）:**

应用软件是指为针对使用者的某种应用目的所撰写的软件。包括办公自动化系统，互连网，多媒体，分析软件，协作软件，商务软件，数据库等。

**高级语言（High-level programming Language ）:**

面向问题和算法描述的语言，也称为算法语言。用这种语言编写程序时，程序员不必了解实际机器的结构、指令系统等细节，而通过一种比较习惯的、直接的方式来描述问题和算法。

**汇编语言（Assembly Language） :**

汇编语言是一种面向实际机器的低级语言，是机器语言的符号表示，与机器语言一一对应。所以，汇编语言程序员必须对机器的结构和指令系统等细节非常清楚。

**机器语言（Machine Language）:**

机器语言是指直接用二进制代码（即：指令）表示的语言。用户必须用二进制代码来编写程序。所以机器语言程序员必须对机器的结构和指令系统等细节非常清楚。

**源程序（Source Program）:**

编译程序、解释程序和汇编程序统称为语言处理程序。各种语言处理程序处理的对象称为源程序，它们是用高级（算法）语言或汇编语言编写的程序。如，C语言源程序，Java语言源程序，汇编语言源程序等。

**目标程序（Object Program）:**

编译程序和汇编程序对源程序进行翻译处理所得到的结果程序称为目标程序，是由机器指令组成的二进制代码。

**编译程序（Complier）:**

编译程序完成从高级语言源程序到目标程序的转换。它将高级语言源程序全部翻译成目标程序，每次执行程序时，直接执行对应的目标程序，因此，只要源程序不变，就无需重新编译。

**解释程序（Interpreter）:**

解释程序将源程序的一条语句翻译成对应的机器目标代码，并立即执行，然后翻译下一条源程序语句并执行，直至所有源程序中的语句全部被翻译并执行完。所以，解释程序的执行过程是翻译一句，执行一句。直接输出源程序的执行结果，而不是输出目标程序。所以每次执行程序时，直接启动源程序执行。

**汇编程序（Assembler）:**

汇编程序也是一种语言翻译程序，它把汇编语言写的源程序翻译为机器语言目标程序。

**操作系统（Operating System）:**

操作系统（Operating System，简称OS），是计算机系统中负责支撑应用程序运行环境以及用户操作环境的系统软件，同时也是计算机系统的核心与基石。它的职责常包括对硬件的直接监管、对各种计算资源（如内存、处理器时间等）的管理、以及提供诸如作业管理之类的面向应用程序的服务等等。 目前比较流行的操作系统主要有两个家族：类Unix家族和微软Windows家族。

**算术逻辑单元 （Arithmetic Logic Unit 简称 ALU）:**

它是计算机对数据进行加工处理的部件，包括算术运算和逻辑运算。

**累加器（Accumulator）:**

在中央处理器 CPU 中，累加器 (accumulator 简称 ACC) 是一种暂存器，用来储存计算所产生的中间结果。如果没有像累加器这样的暂存器，那么在每次计算后就必须要把结果写回到内存，然后可能还要再读回来。这样，就会增加访问内存的次数，降低程序运行的效率。典型的例子就是把一列数字加起来。一开始累加器设定为零，每个数字依序被加到累加器中，当所有数字都被加入后，结果才写回到主内存中。

**运算器（Arithmetic Logic Unit , ALU）:**

运算器主要由算术逻辑单元和一组寄存器组成。有专门的定点数运算器和浮点数运算器。早期机器只包含累加器、Q乘商寄存器等少量几个寄存器。现代计算机中有专门的定点运算用的定点寄存器组和浮点运算用的浮点寄存器组。

**控制器（Control Unit）:**

控制器负责从存储器中取出指令，并对指令进行译码；根据指令的要求，按时间的先后顺序，负责向其它各部件发出控制信号，保证各部件协调一致地工作，一步一步地完成各种操作。控制器主要由指令寄存器IR、指令译码器ID、程序计数器PC、控制部件CU等组成。

**控制单元（Control Unit）:**

控制单元（Control Unit 简称 CU），有时也称为“微操作信号形成部件”。其作用是对指令译码信号、状态标志信号、时序信号等进行组合，产生各种操作控制信号。

**中央处理器（Central Processing Unit ， CPU ）:**

中央处理器（CPU）是计算机中最重要的一个部分，由运算器和控制器组成。其内部结构归纳起来可以分为控制单元、逻辑单元和存储单元三大部分，这三个部分相互协调，对命令和数据进行分析、判断、运算并控制计算机各部分协调工作。

**程序计数器（Program Counter）:**

程序计数器（Program Counter，简称PC）又称指令计数器，用来存放指令的地址，以便准确地指出后继指令的存储单元地址。通常程序是顺序执行的，程序的指令序列在内存中一般也是按连续地址存放的。在开始运行程序之前，总是将第一条指令的地址放入PC。当第一条指令被取出执行，控制器就使PC的内容自动增量（加“1”），指明下一条要执行的指令所存放的存储单元地址，以控制指令的顺序执行。在遇到需要改变程序执行顺序的情况时，一般由转移类指令将转移目标地址送往程序计数器，即可实现程序的转移。

**指令寄存器（Instruction Register）:**

指令寄存器（Instruction Register 简称IR）用来保存当前正在执行的一条指令。当执行一条指令时，先从存储器取出指令，然后送至指令寄存器。指令寄存器中的操作码部分被送到指令译码器ID(Instruction Decoder)，经ID译码(识别这条指令的功能)后，送到操作控制单元CU，由CU对指令译码信号、状态标志信号、时序信号等进行组合，最终送出具体的操作控制信号。

**存储器（Memory）:**

计算机的存储器主要由两部分组成——内存储器和外存储器。内存存取速度快、容量小、价格贵；外存容量大、价格低，但是存取速度慢。

**主存（内存）（Main Memory）:**

位于CPU之外，用来存放已被启动的程序及所用的数据。有ROM芯片和RAM芯片组成相应的ROM存储区和RAM存储区。RAM存储区用动态随机访问存储器实现。

**辅存（外存）（Secondary Memory）:**

位于主机之外，用来存放暂不运行的程序和数据，容量大而速度慢。外存也属于输入输出设备，它只能与主存直接交换信息。外存储器主要有磁盘存储器、磁带存储器和光盘存储器。磁盘是最常用的外存储器，通常它分为软盘和硬盘两类。容量极大、价格便宜的磁带机和光盘组等称为海量存储器，常用作数据备份。

**记忆单元（存储基元、存储元）（Memory Cell）:**

具有两种稳态的能够表示二进制数码0和1的物理器件。所以，一个记忆单元表示1位信息。

**存储单元（Memory Unit）:**

主存中具有相同地址的那些位构成一个存储单元。因此，存储单元的宽度等于一个编址单位的长度，可以是8位、16位、32位等。现在，大多数计算机是按字节编址的，即：每一个字节（8位）有一个地址，编址单位就是一个字节，所以一个存储单元的宽度（位数）是8位。

**存储器地址寄存器 （Memory Address Register - MAR）:**

CPU中用来存放存储器地址的寄存器，地址在送到总线的地址线之前，现寄存在MAR中。所以，它的宽度应该等于地址线的宽度，也等于主存储器的地址位数，其值决定了主存最大的寻址空间。

**存储器数据寄存器（Memory Data Register，MDR）:**

CPU中用来存放写入主存或从主存读出的数据的寄存器，数据在送到总线的数据线之前，或从主存读到CPU时，都先寄存在MDR中。所以，它的宽度应该等于总线数据线的宽度。

**存储容量（Memory Capacity）:**

存储器能够容纳的二进制信息量。常用存储单元数与每个单元的位数的乘积表示，或用字节数表示。如：64M x 8位，或64MB。

**机器字长（Machine Word Length）:**

机器字长定义为CPU中在同一时间内一次能够处理的二进制数的位数，即：运算器中参加运算的寄存器的位数。一般把CPU中定点运算器的数据通路宽度定义为字长。

**指令字长（Instruction Length）:**

一条指令的二进制代码位数。有定长指令字机器和不定长指令字机器。定长指令字机器中所有指令的位数是相同的，目前定长指令字大多是32位指令字。不定长指令字机器的指令有长有短，但每条指令的长度一般都是8的倍数。

**CPI（Cycle Per Instruction）:**

衡量CPU性能的一种计量单位。表示执行一条指令所需的时钟个数。

**MIPS （Million Instructions Per Second）:**

是计算机定点运算速度的一种计量单位。用来表示每秒钟执行多少百万条指令。

**FLOPS（floating-point operations per second）:**

是计算机浮点运算速度的一种计量单位。表示每秒所执行的浮点运算次数。

链接：http://media.njude.com.cn/vclass/Courses/15201A/CourseDetail.aspx?id=4630

### 参考书籍：

计算机组成原理（第 2 版）

Computer Organization And Design

Digital Design and Computer Architecture

![image-20230817204809269](pic/image-20230817204809269.png)