# 计算机网络

## 1. 概述

### 1.1 电路交换、报文交换、分组交换的对比

![image-20230823195103821](pic/image-20230823195103821.png)

![image-20230823195121644](pic/image-20230823195121644.png)

分组类似 CPU 流水。

**网络分组**

![image-20230823195304198](pic/image-20230823195304198.png)

### 1.2 性能指标

**常用的数据量单位**

1 Byte = 8 bit (比特位)

1 KB = 2^10B (1024B)

1 MB = K*KB = 2^20B

1 GB = K*MB = 2^30B

1 TB = K*GB = 2^40B

250G(10进制) = 250 x 10^9 / 2^30 = 232.8GB 

**速率** bit/s (b/s bps)

kb/s = 10^3 b/s （1000 b/s）

Mb/s = k*kb/s = 10^6 b/s （1000 b/s）

...

一个是 1024 进制 一个 1000 进制 计算时换算成最小 bit 使用

例子：

一个待发送数据块大小 100M，速率 为 100Mbps，求发送时间？

100 x 1024(K) x 1024(B) x 8bit / 100 x 10^6 bps = 8.388608s

![image-20230823201815653](pic/image-20230823201815653.png)

**带宽**

用来表示网络的通信线路所能传送数据的能力，因此网络带宽标识在单位时间内从网络中的某一点到另一点所能通过的“最高数据率”，单位同速率

**吞吐量**

表示在单位时间内通过某个网络或信道、接口的数据量

**时延**

发送时延（分组长度(b)/发送速率(b/s)）

传播时延（信道长度(m)/电磁波传播速率(m/s)）

自由空间：3x10^8 铜线：2.3x10^8 光纤：2.0x10^8

处理时延（不方便计算）

**时延带宽积**

**往返时间**

一般交互都是双向交互，双向交互一次的时间是往返时间 RTT

**利用率**

信道利用率：信道有百分之几的时间是被利用的（有数据通过）

网络利用率：全网络的信道利用率的加权平均

利用率并非越高越好，增大时时延也会增加

一些较大主干网 ISP 利用率超过 50% 就要准备扩容

**丢包率**

一定时间内，丢失的分组数量与总分组数量的比率

接口、结点、链路、路径、网络丢包率等

原因：分组误码、网络拥塞

### 1.3 体系结构

**OSI 体系结构、TCP/IP体系结构**

![image-20230824103546382](pic/image-20230824103546382.png)

四层结构

![image-20230824103805171](pic/image-20230824103805171.png)

**各层需要解决的问题**

应用层：解决通过应用进程的交互来实现特定网络应用的问题（进程号、端口）

运输层：解决进程之间基于网络的通信问题

网络层：解决分组在多个网络上传输（路由）的问题

数据链路层：解决分组在一个网络（一段链路）上传输的问题

物理层：解决使用何种信号来传输比特的问题（0,1方波）

![无标题](pic/无标题.png)

从浏览器发起请求，到服务器响应 从 应用层开始 HTTP 每经过一层便会加上一层协议（运输层加 TCP、网络层加 IP、数据链路加 ETH、物理层转为 bit（01进制数据））由路由解析到网络层定位 IP 地址，转发到目标服务器。

![image-20230824202801523](pic/image-20230824202801523.png)

## 2. 物理层

### 2.1 基本概念

传输 01 bit 信号，分为以下两种：

导引型：光纤、同轴电缆、双绞线、电力线

非导引型：无线电波、微波、红外线、可见光 2-40GHz

**传输方式：**

串行、并行传输，同步、异步传输，单向、双向交替、双向同时通信

**编码与调制：**

不归零编码、归零编码、曼彻斯特编码、差分曼特斯特编码

![image-20230824160449975](pic/image-20230824160449975.png)

## 3. 数据链路层

### 3.1 基础

**链路：**从一个结点到相邻结点的一段物理线路，中间没有任何其他交换结点

**数据链路：**把视线通信协议的硬件和软件加到链路上，就构成了数据链路

数据链路层以**帧**为单位传输和处理数据

**封装成帧：**添加帧头和帧尾

**差错检测：**帧尾有检测码，CRC 检测

**可靠传输：**不管如何都能收到

![image-20230824163421731](pic/image-20230824163421731.png)

ppp使用帧头帧尾来区分每一帧

**透明传输：**因为帧头帧尾也是 0 1 ，如何判定是头尾而非数据？或者需要好几个帧传输数据，又如何不让其结束？插入转义字符（特点标记esc）遇到了就说明没有结束

每一种数据链路都规定了帧的数据部分长度上线，最大传送单元 MTU(Maximum Transfer Unit)

### 3.2 点对点协议 PPP

![image-20230824173250403](pic/image-20230824173250403.png)

![image-20230824173712297](pic/image-20230824173712297.png)

### 3.3 媒体计入控制 MAC

#### 静态划分信道 

**信道复用**：频分复用 FDM、时分复用 TDM、波分复用 WDM、码分复用 CDM

多个用户使用一个信道传输数据

#### 动态接入控制

**受控接入：**集中控制、分散控制  

**随机接入：**

多址接入MA、载波监听CS、碰撞检测CD

CSMA/CD协议-争用期（碰撞窗口）

**MAC 地址**ARP 协议

![image-20230824201437581](pic/image-20230824201437581.png)

每 四 位用一个十六进制标识 一共是12个十六进制数（四十八位）

前 6 位是 IEEE 组织机构分配管理，后 6 位 自己分配

**IP 地址**

网络编号：标识因特网上的网络

主机编号：标识同一网络上不同主机

**数据包转发过程中 IP 地址与 MAC 地址的变化情况：**

![image-20230824203040192](pic/image-20230824203040192.png)

ip 是源地址 -> 目的地址	mac 当前路由 ->下个路由

**ARP 协议**

地址解析协议，不能跨网络使用。

如何获取 ip 地址？

![image-20230824204510889](pic/image-20230824204510889.png)

![image-20230824204550956](pic/image-20230824204550956.png)

![image-20230824204640032](pic/image-20230824204640032.png)

### 3.4 集线器、交换机区别

![image-20230824205114118](pic/image-20230824205114118.png)

以太网交换机自学习和转发帧的流程

![image-20230825150133062](pic/image-20230825150133062.png)

盲目泛洪相当于都发，因为不知道是谁，待有对应关系才能明确发送

记录有有效时间，因为可能有情况（更换网卡等），导致失效。

**生成树协议 STP**

生成逻辑上没有环状的网络结构

**虚拟局域网 VLAN**

一种将局域网内的设备划分成与物理位置无关的逻辑组技术，这些组有共同需求

![image-20230825152151106](pic/image-20230825152151106.png)

## 4. 网络层

网络层主要任务是实现网络互连，进而实现数据包在各网络之间的传输。

主要解决以下问题：

- 网络层向运输层提供怎样的服务（可靠 or 不可靠）
- 网络层寻址问题
- 路由选择问题

### 4.1 提供的两种服务

**面向连接的虚电路服务**

可靠通信由网络保证，必须建立网络层连接-虚电路（逻辑层），然后发送携带地址和虚电路编号。不会丢包、误码（因为建立了连接）。

**无连接的数据报服务**

可靠性由用户主机（自己判断是否丢包、重复等）保证，不需要建立网络层连接，可能误码、失序。

![image-20230825161957688](pic/image-20230825161957688.png)

### 4.2 IPv4 地址

**第一个地址为网络地址，最后一个地址是广播地址**

32 位比特地址，采用点分十进制表示方法，方便使用。

![image-20230825163540458](pic/image-20230825163540458.png)

**子网掩码**

可以表明分类 IP 地址的主机号部分被借用了几个比特作为子网号

将子网的 IPv4 地址与相应的子网掩码进行逻辑与运算就可以得到子网的网络地址

**解释：** 最后 1-254 这些如果没用满，还想分网管理，在前位区分浪费 ip ，所以用掩码这个概念来在 1-254 做分网

例子：

> 某个小型公司有四个部门：行政、研发、营销、售后，每个部门各40台计算机接入公司局域网交换机，如果要在192.168.1.0网段为每个部门划分子网，子网掩码应该怎么设置，每个子网的地址范围分别是什么？
>
> 192.168.1.0网段共256个地址，划分4个子网，每个子网需要64个地址；64是2的6次方，子网掩码应该以6个0结尾，剩下的用1补齐，由26个1和6个0组成，转换成十进制是255.255.255.192；每个子网共64个IP地址，掐头去尾后可用地址只有62个，
>
> 第1个子网的可用IP地址范围是：192.168.1.1-62，
>
> 第2个子网可用IP地址范围是192.168.1.65-126，
>
> 第3个子网的可用IP地址范围是：192.168.1.129-190，
>
> 第4个子网可用IP地址范围是192.168.1.193-254；
>
> 该公司各部门计算机按照3中的IP地址范围进行设置，所有计算机的子网掩码都必须设置为255.255.255.192，设置完毕后各部门内的计算机能正常联网，不同部门间的计算机无法直接联通。

**无分类编址的 IPv4 地址**

地址/掩码1位数

192.168.4.0/30

![image-20230825180725164](pic/image-20230825180725164.png)



